import{d as k,S as E,c,w as l,u as a,I as $,E as m,a as i,b as z,e as B,f as C,g as M,h as A,i as N,j as t,M as T,Y as p,Z as b,$ as U,r as v,V as O,U as j,k as S,a0 as q,z as F,v as P,a1 as G,D as H,F as J,G as u,t as V,_ as L}from"./index-x2tkpoM1.js";import{g as R,r as f,d as y,s as x}from"./firebase-RQfAkDXS.js";const Y={class:"form-container"},Z={class:"form-group"},K={class:"form-group"},Q={class:"form-group"},W=["value"],X=["disabled"],ee={key:2},te={class:"info-box"},ne=k({__name:"AddCar",setup(oe){const g=J(),d=m(!1),I=m({}),o=m({immatriculation:"",description:"",typeIntervention:""});E(async()=>{try{const r=await R(f(y,"type_interventions"));r.exists()&&(I.value=r.val())}catch(r){console.error("Erreur lors du chargement des types d'interventions:",r)}});const w=async()=>{const r=localStorage.getItem("client");if(!r){alert("Vous devez être connecté pour ajouter une voiture."),await g.push("/login");return}let e;try{e=JSON.parse(r).id}catch(n){alert("Erreur: données de session invalides.");return}if(!o.value.immatriculation||!o.value.description||!o.value.typeIntervention){alert("Veuillez remplir tous les champs obligatoires");return}d.value=!0;try{const n=new Date().toISOString(),s="voiture_".concat(Date.now().toString(36),"_").concat(Math.random().toString(36).slice(2,8)),_="reparation_".concat(Date.now().toString(36),"_").concat(Math.random().toString(36).slice(2,8)),D={client_uid:e,created_at:n,date_depot:n,description:o.value.description.trim(),immatriculation:o.value.immatriculation.trim(),statut_id:"enAttente"},h={created_at:n,statut_id:"planifiee",type_intervention_id:o.value.typeIntervention,voiture_id:s};await Promise.all([x(f(y,"voitures/".concat(s)),D),x(f(y,"reparations/".concat(_)),h)]),console.log("Voiture et réparation créées avec succès:",s,_),alert("✅ Votre demande de réparation a été enregistrée !\\n\\nImmatriculation: ".concat(o.value.immatriculation,"\\nStatut: En attente")),await g.replace({name:"Acceuil"})}catch(n){console.error("Erreur lors de l'envoi:",n),alert("Une erreur est survenue. Veuillez réessayer.")}finally{d.value=!1}};return(r,e)=>(u(),c(a($),null,{default:l(()=>[i(a(N),{translucent:!0},{default:l(()=>[i(a(z),null,{default:l(()=>[i(a(B),{slot:"start"},{default:l(()=>[i(a(C),{"default-href":"/acceuil"})]),_:1}),i(a(M),null,{default:l(()=>[...e[3]||(e[3]=[A("Ajouter une voiture",-1)])]),_:1})]),_:1})]),_:1}),i(a(H),{fullscreen:!0,class:"ion-padding"},{default:l(()=>[t("div",Y,[e[10]||(e[10]=t("div",{class:"form-header"},[t("h1",{class:"form-title"},"Déposer une voiture"),t("p",{class:"form-subtitle"},"Décrivez la panne et sélectionnez le type d'intervention")],-1)),t("form",{onSubmit:T(w,["prevent"]),class:"form-section"},[t("div",Z,[e[4]||(e[4]=t("label",{for:"immatriculation",class:"form-label"},"Immatriculation",-1)),p(t("input",{id:"immatriculation","onUpdate:modelValue":e[0]||(e[0]=n=>o.value.immatriculation=n),type:"text",placeholder:"Ex: AB-123-CD",class:"form-input",required:""},null,512),[[b,o.value.immatriculation]])]),t("div",K,[e[5]||(e[5]=t("label",{for:"description",class:"form-label"},"Description du problème",-1)),e[6]||(e[6]=t("p",{class:"form-hint"},"Décrivez en détail la panne ou le problème",-1)),p(t("textarea",{id:"description","onUpdate:modelValue":e[1]||(e[1]=n=>o.value.description=n),placeholder:"Ex: Pneu avant gauche crevé, problème de démarrage...",class:"form-textarea",rows:"5",required:""},null,512),[[b,o.value.description]])]),t("div",Q,[e[8]||(e[8]=t("label",{for:"typeIntervention",class:"form-label"},"Type d'intervention",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.typeIntervention=n),id:"typeIntervention",class:"form-select",required:""},[e[7]||(e[7]=t("option",{value:""},"Sélectionner un type...",-1)),(u(!0),v(j,null,O(I.value,(n,s)=>(u(),v("option",{key:s,value:s},V(n.nom)+" ("+V(n.prix)+"€) ",9,W))),128))],512),[[U,o.value.typeIntervention]])]),t("button",{type:"submit",class:"submit-btn",disabled:d.value},[d.value?(u(),c(a(F),{key:1,name:"dots"})):(u(),c(a(S),{key:0,icon:a(q),class:"btn-icon"},null,8,["icon"])),d.value?P("",!0):(u(),v("span",ee,"Envoyer au garage"))],8,X)],32),t("div",te,[i(a(S),{icon:a(G),class:"info-icon"},null,8,["icon"]),e[9]||(e[9]=t("p",null,"Vos informations seront traitées rapidement par nos techniciens. Vous recevrez une estimation dans les 24h.",-1))])])]),_:1})]),_:1}))}}),ie=L(ne,[["__scopeId","data-v-6e92e304"]]);export{ie as default};
